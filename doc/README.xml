<?xml version="1.0" encoding="UTF-8"?>
<xpan:report xmlns:xpan="https://www.daliboris.cz/ns/xproc/analysis">
   <analysis file-name="alto.xpl"
             path="file:///V:/Projekty/Github/MZK/libri-augmentati/src/xproc/alto.xpl"
             xmlns="https://www.daliboris.cz/ns/xproc/analysis"
             xmlns:xhtml="http://www.w3.org/1999/xhtml">
      <library>
         <prolog>
            <documentation length="0">
               <xhtml:section xmlns:xf="https://www.example.com/ns/xproc/function">
                  <xhtml:h1/>
                  <xhtml:p/>
               </xhtml:section>
            </documentation>
            <namespaces>
               <namespace prefix="p"
                          value="http://www.w3.org/ns/xproc"/>
               <namespace prefix="xf"
                          value="https://www.example.com/ns/xproc/function"/>
               <namespace prefix="xhtml"
                          value="http://www.w3.org/1999/xhtml"/>
               <namespace prefix="xs"
                          value="http://www.w3.org/2001/XMLSchema"/>
               <namespace prefix="xml"
                          value="http://www.w3.org/XML/1998/namespace"/>
            </namespaces>
         </prolog>
         <body>
            <documentation length="0">
               <xhtml:section xmlns:xf="https://www.example.com/ns/xproc/function">
                  <xhtml:h1/>
                  <xhtml:p/>
               </xhtml:section>
            </documentation>
            <step type="xf:first-function-alto"
                  name="fist-function">
               <prolog>
                  <documentation length="0">
                     <xhtml:section xmlns:xf="https://www.example.com/ns/xproc/function">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xf"
                                value="https://www.example.com/ns/xproc/function"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="0">
                     <xhtml:section xmlns:xf="https://www.example.com/ns/xproc/function">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:xslt">
                     <port name="stylesheet">
                        <parameter name="href"
                                   value="../Xslt/?.xsl"/>
                     </port>
                     <parameter name="parameters"
                                value="map {'parameter' : 'value' }"/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:store"
                                value=""/>
                  </call>
               </body>
            </step>
         </body>
      </library>
   </analysis>
   <analysis file-name="conversion.xpl"
             path="file:///V:/Projekty/Github/MZK/libri-augmentati/src/xproc/conversion.xpl"
             xmlns="https://www.daliboris.cz/ns/xproc/analysis"
             xmlns:xhtml="http://www.w3.org/1999/xhtml">
      <library>
         <prolog>
            <documentation length="0">
               <xhtml:section xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                  <xhtml:h1/>
                  <xhtml:p/>
               </xhtml:section>
            </documentation>
            <namespaces>
               <namespace prefix="c"
                          value="http://www.w3.org/ns/xproc-step"/>
               <namespace prefix="lac"
                          value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
               <namespace prefix="lad"
                          value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
               <namespace prefix="p"
                          value="http://www.w3.org/ns/xproc"/>
               <namespace prefix="xhtml"
                          value="http://www.w3.org/1999/xhtml"/>
               <namespace prefix="xs"
                          value="http://www.w3.org/2001/XMLSchema"/>
               <namespace prefix="xml"
                          value="http://www.w3.org/XML/1998/namespace"/>
            </namespaces>
         </prolog>
         <body>
            <documentation length="0">
               <xhtml:section xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                  <xhtml:h1/>
                  <xhtml:p/>
               </xhtml:section>
            </documentation>
            <step type="lac:convert"
                  name="fist-function">
               <prolog>
                  <documentation length="0">
                     <xhtml:section xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="c"
                                value="http://www.w3.org/ns/xproc-step"/>
                     <namespace prefix="lac"
                                value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="source-format"
                             as="xs:string"
                             values="('djvu')"/>
                     <option name="target-format"
                             as="xs:string"
                             values="('pdf', 'tiff')"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="0">
                     <xhtml:section xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:xslt">
                     <port name="stylesheet">
                        <parameter name="href"
                                   value="../Xslt/?.xsl"/>
                     </port>
                     <parameter name="parameters"
                                value="map {'parameter' : 'value' }"/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:store"
                                value=""/>
                  </call>
               </body>
            </step>
            <step type="lac:convert-djvu">
               <prolog>
                  <documentation length="12">
                     <xhtml:section xml:lang="en"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                        <xhtml:h2>Convert DjVu</xhtml:h2>
                        <xhtml:p/>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="c"
                                value="http://www.w3.org/ns/xproc-step"/>
                     <namespace prefix="lac"
                                value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="main-input-directory"
                             as="xs:anyURI"
                             required="true"/>
                     <option name="main-output-directory"
                             as="xs:anyURI"
                             required="true"/>
                     <option name="output-file"
                             as="xs:string"
                             required="true"/>
                     <option name="format"
                             values="('pdf', 'tiff')"
                             select="'pdf'"/>
                     <option name="pdfbox-path"
                             as="xs:string"
                             required="true"/>
                     <option name="ddjvu-path"
                             as="xs:string"
                             required="true"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"
                            sequence="true"/>
                     <output port="result"
                             primary="true"
                             sequence="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="12">
                     <xhtml:section xml:lang="en"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                        <xhtml:h2>Convert DjVu</xhtml:h2>
                        <xhtml:p/>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:viewport">
                     <parameter name="match"
                                value="lad:document"/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="lac:convert-djvu-item"
                                value=""/>
                  </call>
               </body>
            </step>
            <step type="lac:convert-djvu-item">
               <prolog>
                  <documentation length="17">
                     <xhtml:section xml:lang="en"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                        <xhtml:h2>Convert DjVu item</xhtml:h2>
                        <xhtml:p/>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="c"
                                value="http://www.w3.org/ns/xproc-step"/>
                     <namespace prefix="lac"
                                value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="input-directory"
                             as="xs:anyURI"
                             required="true"/>
                     <option name="output-directory"
                             as="xs:anyURI"
                             required="true"/>
                     <option name="output-file"
                             as="xs:anyURI"
                             required="true"/>
                     <option name="format"
                             values="('pdf', 'tiff')"
                             select="'pdf'"/>
                     <option name="pdfbox-path"
                             as="xs:string"
                             required="true"/>
                     <option name="ddjvu-path"
                             as="xs:string"
                             required="true"/>
                  </options>
                  <ports>
                     <input port="source"
                            sequence="true"/>
                     <output port="result"
                             primary="true"
                             sequence="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="17">
                     <xhtml:section xml:lang="en"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                        <xhtml:h2>Convert DjVu item</xhtml:h2>
                        <xhtml:p/>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:directory-list">
                     <parameter name="path"
                                value="{$input-directory}"/>
                  </call>
                  <call step="p:for-each">
                     <port name="anonymous">
                        <parameter name="select"
                                   value="//c:file"/>
                     </port>
                  </call>
                  <call step="p:text-join"
                        name="djvu-conversion">
                     <parameter name="separator"
                                value="&#xA;"/>
                  </call>
                  <call step="p:identity">
                     <port name="source"/>
                  </call>
                  <call step="lac:fix-path"
                        name="pdf-merge">
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                  </call>
                  <call step="p:text-join">
                     <parameter name="separator"
                                value="&#xA;"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="@djvu-conversion @pdf-merge"/>
                     </port>
                  </call>
                  <call step="p:store">
                     <parameter name="href"
                                value="{$output-file}"/>
                  </call>
                  <call step="p:file-mkdir">
                     <parameter name="href"
                                value="{$output-directory}"/>
                  </call>
               </body>
            </step>
            <step type="lac:fix-path"
                  name="fixing-path">
               <prolog>
                  <documentation length="8">
                     <xhtml:section xml:lang="en"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                        <xhtml:h2>Fix path</xhtml:h2>
                        <xhtml:p/>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="c"
                                value="http://www.w3.org/ns/xproc-step"/>
                     <namespace prefix="lac"
                                value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                  </options>
                  <ports>
                     <input port="source"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="8">
                     <xhtml:section xml:lang="en"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                        <xhtml:h2>Fix path</xhtml:h2>
                        <xhtml:p/>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:file-info">
                     <parameter name="href"
                                value="file:///C:/Windows"/>
                     <parameter name="fail-on-error"
                                value="false"/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="exists(/c:directory[@name='Windows'])"/>
                     <parameter name="p:text-replace"
                                value="&#xA;    &#xA;   "/>
                     <parameter name="p:text-replace"
                                value=""/>
                  </call>
               </body>
            </step>
         </body>
      </library>
   </analysis>
   <analysis file-name="enrichment.xpl"
             path="file:///V:/Projekty/Github/MZK/libri-augmentati/src/xproc/enrichment.xpl"
             xmlns="https://www.daliboris.cz/ns/xproc/analysis"
             xmlns:xhtml="http://www.w3.org/1999/xhtml">
      <library>
         <prolog>
            <documentation length="178">
               <xhtml:section xml:lang="en"
                              xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                              xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                              xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Enrichment</xhtml:h1>
                  <xhtml:p>The main programming library for enrichment data by external (web) services.</xhtml:p>
               </xhtml:section>
               <xhtml:section xml:lang="cs"
                              xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                              xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                              xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Obohacení</xhtml:h1>
                  <xhtml:p>Hlavní programová knihovna pro obohacení dat pomocí externích (webových) služeb.</xhtml:p>
               </xhtml:section>
            </documentation>
            <namespaces>
               <namespace prefix="lad"
                          value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
               <namespace prefix="lae"
                          value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
               <namespace prefix="lant"
                          value="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"/>
               <namespace prefix="lap"
                          value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
               <namespace prefix="lar"
                          value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
               <namespace prefix="las"
                          value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
               <namespace prefix="lax"
                          value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
               <namespace prefix="p"
                          value="http://www.w3.org/ns/xproc"/>
               <namespace prefix="xhtml"
                          value="http://www.w3.org/1999/xhtml"/>
               <namespace prefix="xs"
                          value="http://www.w3.org/2001/XMLSchema"/>
               <namespace prefix="xml"
                          value="http://www.w3.org/XML/1998/namespace"/>
            </namespaces>
            <imports/>
         </prolog>
         <body>
            <documentation length="178">
               <xhtml:section xml:lang="en"
                              xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                              xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                              xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Enrichment</xhtml:h1>
                  <xhtml:p>The main programming library for enrichment data by external (web) services.</xhtml:p>
               </xhtml:section>
               <xhtml:section xml:lang="cs"
                              xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                              xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                              xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Obohacení</xhtml:h1>
                  <xhtml:p>Hlavní programová knihovna pro obohacení dat pomocí externích (webových) služeb.</xhtml:p>
               </xhtml:section>
            </documentation>
            <step type="lae:enrich-data"
                  name="enriching-data">
               <prolog>
                  <namespaces>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lae"
                                value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
                     <namespace prefix="lant"
                                value="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"/>
                     <namespace prefix="lap"
                                value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
                     <namespace prefix="lar"
                                value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="output-directory"
                             required="true"
                             as="xs:string"/>
                     <option name="pause-before-request"
                             select="2"
                             as="xs:integer"/>
                     <option name="output-format"
                             values="('TEXT', 'TEI')"
                             as="xs:string*"/>
                     <option name="enrichment"
                             values="('ENTITIES', 'MORPHOLOGY')"
                             as="xs:string*"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"
                            sequence="true"/>
                     <input port="settings"
                            primary="false"/>
                     <input port="report-in"
                            sequence="true"/>
                     <output port="result"
                             primary="true"
                             sequence="true"/>
                     <output port="report"
                             pipe="report-in@enriching-data"/>
                  </ports>
               </prolog>
               <body>
                  <call step="p:if">
                     <parameter name="test"
                                value="$enrichment = 'ENTITIES'"/>
                     <parameter name="lae:enrich-by-entities"
                                value="&#xA;    &#xA;    &#xA;   "/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$enrichment = 'MORPHOLOGY'"/>
                     <parameter name="lae:enrich-by-morphology"
                                value="&#xA;    &#xA;    &#xA;   "/>
                  </call>
               </body>
            </step>
            <step type="lae:enrich-by-entities"
                  name="enriching-by-entities">
               <prolog>
                  <documentation length="144">
                     <xhtml:section xml:lang="en"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Enrich by entities</xhtml:h2>
                        <xhtml:p>Enriches available (textual) data by named entities.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Obohacení o entity</xhtml:h2>
                        <xhtml:p>Obohatí dostupná (textová) data o pojmenované entity.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lae"
                                value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
                     <namespace prefix="lant"
                                value="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"/>
                     <namespace prefix="lap"
                                value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
                     <namespace prefix="lar"
                                value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="output-directory"
                             required="true"
                             as="xs:string"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"
                            sequence="true"/>
                     <input port="settings"
                            primary="false"/>
                     <input port="report-in"/>
                     <output port="result"
                             primary="true"
                             sequence="true"
                             pipe="result@final"/>
                     <output port="report"
                             pipe="result@report-final"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="144">
                     <xhtml:section xml:lang="en"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Enrich by entities</xhtml:h2>
                        <xhtml:p>Enriches available (textual) data by named entities.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Obohacení o entity</xhtml:h2>
                        <xhtml:p>Obohatí dostupná (textová) data o pojmenované entity.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:insert"
                        name="report-start">
                     <parameter name="position"
                                value="last-child"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="report-in@enriching-by-entities"/>
                     </port>
                     <port name="insertion"/>
                  </call>
                  <call step="lant:get-nametag-analyses">
                     <parameter name="output-directory"
                                value="{$output-directory}"/>
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="source@enriching-by-entities"/>
                     </port>
                     <port name="settings">
                        <parameter name="pipe"
                                   value="settings@enriching-by-entities"/>
                     </port>
                     <port name="report-in">
                        <parameter name="pipe"
                                   value="result@report-start"/>
                     </port>
                  </call>
                  <call step="p:identity"
                        name="final"/>
                  <call step="p:add-attribute"
                        name="report-final">
                     <parameter name="match"
                                value="lax:step[@type='lae:enrich-by-entities'][not(@end)]"/>
                     <parameter name="attribute-name"
                                value="end"/>
                     <parameter name="attribute-value"
                                value="{current-dateTime()}"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="result@report-start"/>
                     </port>
                  </call>
               </body>
            </step>
            <step type="lae:enrich-by-morphology"
                  name="enriching-by-morphology">
               <prolog>
                  <documentation length="186">
                     <xhtml:section xml:lang="en"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Enrich by morphology</xhtml:h2>
                        <xhtml:p>Enriches available (textual) data by morphological and syntactic analysis.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Obohacení o entity</xhtml:h2>
                        <xhtml:p>Obohatí dostupná (textová) data o morfologickou a syntaktickou analýzu.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lae"
                                value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
                     <namespace prefix="lant"
                                value="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"/>
                     <namespace prefix="lap"
                                value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
                     <namespace prefix="lar"
                                value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="output-directory"
                             required="true"
                             as="xs:string"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"
                            sequence="true"/>
                     <input port="settings"
                            primary="false"/>
                     <input port="report-in"/>
                     <output port="result"
                             primary="true"
                             sequence="true"
                             pipe="result@final"/>
                     <output port="report"
                             pipe="result@report-final"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="186">
                     <xhtml:section xml:lang="en"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Enrich by morphology</xhtml:h2>
                        <xhtml:p>Enriches available (textual) data by morphological and syntactic analysis.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Obohacení o entity</xhtml:h2>
                        <xhtml:p>Obohatí dostupná (textová) data o morfologickou a syntaktickou analýzu.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:insert"
                        name="report-start">
                     <parameter name="position"
                                value="last-child"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="report-in@enriching-by-morphology"/>
                     </port>
                     <port name="insertion"/>
                  </call>
                  <call step="p:identity">
                     <port name="source">
                        <parameter name="pipe"
                                   value="source@enriching-by-morphology"/>
                     </port>
                  </call>
                  <call step="p:identity"
                        name="final"/>
                  <call step="p:add-attribute"
                        name="report-final">
                     <parameter name="match"
                                value="lax:step[@type='lae:enrich-by-morphology'][not(@end)]"/>
                     <parameter name="attribute-name"
                                value="end"/>
                     <parameter name="attribute-value"
                                value="{current-dateTime()}"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="result@report-start"/>
                     </port>
                  </call>
               </body>
            </step>
         </body>
      </library>
   </analysis>
   <analysis file-name="kramerius-5.xpl"
             path="file:///V:/Projekty/Github/MZK/libri-augmentati/src/xproc/kramerius-5.xpl"
             xmlns="https://www.daliboris.cz/ns/xproc/analysis"
             xmlns:xhtml="http://www.w3.org/1999/xhtml">
      <library>
         <prolog>
            <documentation length="166">
               <xhtml:section xml:lang="en"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                              xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                              xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Kramerius 5</xhtml:h1>
                  <xhtml:p>Programming library for communication with the system <xhtml:a href="https://system-kramerius.cz/en">Kramerius</xhtml:a>, <xhtml:a href="https://github.com/ceskaexpedice/kramerius/wiki/ClientAPIDEV">version 5</xhtml:a>.</xhtml:p>
               </xhtml:section>
               <xhtml:section xml:lang="cs"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                              xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                              xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Kramerius 5</xhtml:h1>
                  <xhtml:p>Programová knihovna pro komunikaci se systémem <xhtml:a href="https://system-kramerius.cz">Kramerius</xhtml:a>, <xhtml:a href="https://github.com/ceskaexpedice/kramerius/wiki/ClientAPIDEV">verze 5</xhtml:a>.</xhtml:p>
               </xhtml:section>
            </documentation>
            <namespaces>
               <namespace prefix="array"
                          value="http://www.w3.org/2005/xpath-functions/array"/>
               <namespace prefix="lad"
                          value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
               <namespace prefix="las"
                          value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
               <namespace prefix="lax"
                          value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
               <namespace prefix="map"
                          value="http://www.w3.org/2005/xpath-functions/map"/>
               <namespace prefix="p"
                          value="http://www.w3.org/ns/xproc"/>
               <namespace prefix="xhtml"
                          value="http://www.w3.org/1999/xhtml"/>
               <namespace prefix="xlog"
                          value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
               <namespace prefix="xs"
                          value="http://www.w3.org/2001/XMLSchema"/>
               <namespace prefix="xml"
                          value="http://www.w3.org/XML/1998/namespace"/>
            </namespaces>
            <options/>
         </prolog>
         <body>
            <documentation length="166">
               <xhtml:section xml:lang="en"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                              xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                              xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Kramerius 5</xhtml:h1>
                  <xhtml:p>Programming library for communication with the system <xhtml:a href="https://system-kramerius.cz/en">Kramerius</xhtml:a>, <xhtml:a href="https://github.com/ceskaexpedice/kramerius/wiki/ClientAPIDEV">version 5</xhtml:a>.</xhtml:p>
               </xhtml:section>
               <xhtml:section xml:lang="cs"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                              xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                              xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Kramerius 5</xhtml:h1>
                  <xhtml:p>Programová knihovna pro komunikaci se systémem <xhtml:a href="https://system-kramerius.cz">Kramerius</xhtml:a>, <xhtml:a href="https://github.com/ceskaexpedice/kramerius/wiki/ClientAPIDEV">verze 5</xhtml:a>.</xhtml:p>
               </xhtml:section>
            </documentation>
            <step type="lax:get-virtual-document-metadata-v5"
                  name="getting-virtual-document-metadata">
               <prolog>
                  <documentation length="495">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get virtual document metadata</xhtml:h2>
                        <xhtml:p>Gathers all requested metadata about the publication. Creates the content of the virtual document with links to all requested resources.</xhtml:p>
                        <xhtml:p>Enhance input data by adding requested resources on the document and page level.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Získání metadat virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Shromáždí všechna požadovaná metadata o publikaci. Vytvoří strukturu virutálního dokumentu s odkazy na všechny požadované zdroje.</xhtml:p>
                        <xhtml:p>Obohatí vstupní data přidáním požadovaných zdrojů na úrovni dokumentu a strany.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="495">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get virtual document metadata</xhtml:h2>
                        <xhtml:p>Gathers all requested metadata about the publication. Creates the content of the virtual document with links to all requested resources.</xhtml:p>
                        <xhtml:p>Enhance input data by adding requested resources on the document and page level.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Získání metadat virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Shromáždí všechna požadovaná metadata o publikaci. Vytvoří strukturu virutálního dokumentu s odkazy na všechny požadované zdroje.</xhtml:p>
                        <xhtml:p>Obohatí vstupní data přidáním požadovaných zdrojů na úrovni dokumentu a strany.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:variable"
                        name="base-url">
                     <parameter name="select"
                                value="/lad:document/lad:options/@base-url"/>
                  </call>
                  <call step="p:variable"
                        name="id">
                     <parameter name="select"
                                value="/lad:document/@id"/>
                  </call>
                  <call step="p:variable"
                        name="guid">
                     <parameter name="select"
                                value="substring-after(/lad:document/@id, ':')"/>
                  </call>
                  <call step="p:variable"
                        name="url">
                     <parameter name="select"
                                value="concat($base-url, '/item/', $id, '/children')"/>
                  </call>
                  <call step="p:insert">
                     <parameter name="match"
                                value="/lad:document"/>
                     <parameter name="position"
                                value="last-child"/>
                     <port name="insertion"/>
                  </call>
                  <call step="p:identity"
                        name="document-with-resources"/>
                  <call step="lax:get-virtual-document-pages">
                     <parameter name="url"
                                value="{$url}"/>
                     <parameter name="document-id"
                                value="{$guid}"/>
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                  </call>
                  <call step="lax:get-available-formats">
                     <parameter name="base-url"
                                value="{$base-url}"/>
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                  </call>
                  <call step="lax:get-source-url">
                     <parameter name="base-url"
                                value="{$base-url}"/>
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                  </call>
                  <call step="p:identity"
                        name="pages"/>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:store"
                                value=""/>
                  </call>
                  <call step="p:insert">
                     <parameter name="match"
                                value="/lad:document"/>
                     <parameter name="position"
                                value="last-child"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="result@document-with-resources"/>
                     </port>
                     <port name="insertion">
                        <parameter name="pipe"
                                   value="result@pages"/>
                     </port>
                  </call>
                  <call step="p:viewport">
                     <parameter name="match"
                                value="lad:page"/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:add-attribute"
                                value=""/>
                     <parameter name="p:viewport"
                                value="&#xA;                &#xA;   "/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:store"
                                value=""/>
                  </call>
               </body>
            </step>
            <step type="lax:get-virtual-document-data-v5"
                  name="getting-virtual-document-data">
               <prolog>
                  <documentation length="490">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get virtual document data</xhtml:h2>
                        <xhtml:p>Gathers all requested data about the publication. Downloads the content (files) of the virtual document from external targets.</xhtml:p>
                        <xhtml:p>Saves data to the disk and enhance input data by adding info about local path of the requested resources.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Získání dat virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Shromáždí všechna požadovaná data publikace. Stáhne obsah (soubory) virutálního dokumentu z externích odkazů.</xhtml:p>
                        <xhtml:p>Uloží data na disk a obohatí vstupní data přidáním informace o lokálním uložení zdrojů.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="490">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get virtual document data</xhtml:h2>
                        <xhtml:p>Gathers all requested data about the publication. Downloads the content (files) of the virtual document from external targets.</xhtml:p>
                        <xhtml:p>Saves data to the disk and enhance input data by adding info about local path of the requested resources.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Získání dat virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Shromáždí všechna požadovaná data publikace. Stáhne obsah (soubory) virutálního dokumentu z externích odkazů.</xhtml:p>
                        <xhtml:p>Uloží data na disk a obohatí vstupní data přidáním informace o lokálním uložení zdrojů.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:insert">
                     <parameter name="position"
                                value="last-child"/>
                     <port name="insertion"/>
                  </call>
               </body>
            </step>
            <step type="lax:get-virtual-document-pages">
               <prolog>
                  <documentation length="329">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get virtual document pages</xhtml:h2>
                        <xhtml:p>Creates element for each page of the document that contains basic data: identifier, type and (page) number.</xhtml:p>
                        <xhtml:p>Returns element <xhtml:code>&lt;lad:pages&gt;</xhtml:code>
                        </xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Získání stránek virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Pro každou stránku dokumentu vytvoří element se základními údaji: identifikátor, typ a číslo (strany).</xhtml:p>
                        <xhtml:p>Vrací element <xhtml:code>&lt;lad:pages&gt;</xhtml:code>
                        </xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="url"
                             as="xs:string"/>
                     <option name="document-id"
                             as="xs:string"/>
                  </options>
                  <ports>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="329">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get virtual document pages</xhtml:h2>
                        <xhtml:p>Creates element for each page of the document that contains basic data: identifier, type and (page) number.</xhtml:p>
                        <xhtml:p>Returns element <xhtml:code>&lt;lad:pages&gt;</xhtml:code>
                        </xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Získání stránek virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Pro každou stránku dokumentu vytvoří element se základními údaji: identifikátor, typ a číslo (strany).</xhtml:p>
                        <xhtml:p>Vrací element <xhtml:code>&lt;lad:pages&gt;</xhtml:code>
                        </xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:http-request">
                     <parameter name="method"
                                value="GET"/>
                     <parameter name="href"
                                value="{$url}"/>
                     <port name="source"/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:store"
                                value=""/>
                  </call>
                  <call step="lax:pages-convert-json-to-xml">
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                  </call>
               </body>
            </step>
            <step type="lax:pages-convert-json-to-xml">
               <prolog>
                  <documentation length="387">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Pages: convert JSON to XML</xhtml:h2>
                        <xhtml:p>Converts from JSON to XML data about the document page. Creates element for the page with basic data: identifier, type and (page) number.</xhtml:p>
                        <xhtml:p>Returns <xhtml:code>&lt;lad:page&gt;</xhtml:code> element.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Strany: konverze JSONu na XML</xhtml:h2>
                        <xhtml:p>Zkonvertuje údje o stránce z JSONu do XML. Vytvoří element pro stránku dokumentu se základními údaji: identifikátor, typ a číslo (strany).</xhtml:p>
                        <xhtml:p>Vrací element <xhtml:code>&lt;lad:page&gt;</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="387">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Pages: convert JSON to XML</xhtml:h2>
                        <xhtml:p>Converts from JSON to XML data about the document page. Creates element for the page with basic data: identifier, type and (page) number.</xhtml:p>
                        <xhtml:p>Returns <xhtml:code>&lt;lad:page&gt;</xhtml:code> element.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Strany: konverze JSONu na XML</xhtml:h2>
                        <xhtml:p>Zkonvertuje údje o stránce z JSONu do XML. Vytvoří element pro stránku dokumentu se základními údaji: identifikátor, typ a číslo (strany).</xhtml:p>
                        <xhtml:p>Vrací element <xhtml:code>&lt;lad:page&gt;</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:for-each">
                     <port name="anonymous">
                        <parameter name="select"
                                   value=".?*"/>
                     </port>
                  </call>
                  <call step="p:wrap-sequence">
                     <parameter name="wrapper"
                                value="lad:pages"/>
                  </call>
               </body>
            </step>
            <step type="lax:get-source-url"
                  name="getting-source-url">
               <prolog>
                  <documentation length="371">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get source URL</xhtml:h2>
                        <xhtml:p>For a resource associated with a page, builds a URL from the base URL, API version, document identifier, etc.</xhtml:p>
                        <xhtml:p>Creates <xhtml:code>@url</xhtml:code> attribute for the <xhtml:code>&lt;lad:page&gt;</xhtml:code> element.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Sestavení URL zdroje</xhtml:h2>
                        <xhtml:p>Pro zdroj přiřazený ke stránce sestaví adresu URL ze základní adresy URL, verze rozhraní API, identifikátoru dokumentu apod.</xhtml:p>
                        <xhtml:p>Vytvoří atribut <xhtml:code>@url</xhtml:code> v rámci elementu <xhtml:code>&lt;lad:page&gt;</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="base-url"
                             as="xs:anyURI"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="371">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get source URL</xhtml:h2>
                        <xhtml:p>For a resource associated with a page, builds a URL from the base URL, API version, document identifier, etc.</xhtml:p>
                        <xhtml:p>Creates <xhtml:code>@url</xhtml:code> attribute for the <xhtml:code>&lt;lad:page&gt;</xhtml:code> element.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Sestavení URL zdroje</xhtml:h2>
                        <xhtml:p>Pro zdroj přiřazený ke stránce sestaví adresu URL ze základní adresy URL, verze rozhraní API, identifikátoru dokumentu apod.</xhtml:p>
                        <xhtml:p>Vytvoří atribut <xhtml:code>@url</xhtml:code> v rámci elementu <xhtml:code>&lt;lad:page&gt;</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:viewport">
                     <parameter name="match"
                                value="lad:page"/>
                     <parameter name="p:if"
                                value="&#xA;    &#xA;   "/>
                     <parameter name="p:if"
                                value="&#xA;    &#xA;   "/>
                     <parameter name="p:if"
                                value="&#xA;    &#xA;   "/>
                     <parameter name="p:if"
                                value="&#xA;    &#xA;   "/>
                     <parameter name="p:if"
                                value="&#xA;    &#xA;   "/>
                     <parameter name="p:if"
                                value="&#xA;    &#xA;   "/>
                  </call>
                  <call step="p:viewport">
                     <parameter name="match"
                                value="lad:page"/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:viewport"
                                value="&#xA;    &#xA;    &#xA;   "/>
                  </call>
               </body>
            </step>
            <step type="lax:get-available-formats"
                  name="getting-available-formats">
               <prolog>
                  <documentation length="378">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get available formats</xhtml:h2>
                        <xhtml:p>Selects one page from the middle of the document and checks which resources are available on-line.</xhtml:p>
                        <xhtml:p>For each requested <xhtml:code>&lt;resource&gt;</xhtml:code> adds <xhtml:code>@available</xhtml:code> attribute.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Zjištění dostupných formátů</xhtml:h2>
                        <xhtml:p>Pro stránku zprostředka publikace zjistí, které všechny zdroje jsou dostupné on-line.</xhtml:p>
                        <xhtml:p>Pro každý požadovaný zdroj vytvoří atribut <xhtml:code>@available</xhtml:code> v rámci elementu <xhtml:code>&lt;lad:resource&gt;</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="base-url"
                             as="xs:anyURI"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="378">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get available formats</xhtml:h2>
                        <xhtml:p>Selects one page from the middle of the document and checks which resources are available on-line.</xhtml:p>
                        <xhtml:p>For each requested <xhtml:code>&lt;resource&gt;</xhtml:code> adds <xhtml:code>@available</xhtml:code> attribute.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Zjištění dostupných formátů</xhtml:h2>
                        <xhtml:p>Pro stránku zprostředka publikace zjistí, které všechny zdroje jsou dostupné on-line.</xhtml:p>
                        <xhtml:p>Pro každý požadovaný zdroj vytvoří atribut <xhtml:code>@available</xhtml:code> v rámci elementu <xhtml:code>&lt;lad:resource&gt;</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="size">
                     <parameter name="select"
                                value="count(/lad:pages/lad:page)"/>
                     <parameter name="as"
                                value="xs:integer"/>
                  </call>
                  <call step="p:variable"
                        name="page">
                     <parameter name="select"
                                value="/lad:pages/lad:page[xs:integer($size div 2)]"/>
                  </call>
                  <call step="p:variable"
                        name="url">
                     <parameter name="select"
                                value="concat($base-url, '/item/', $page/@id)"/>
                  </call>
                  <call step="p:variable"
                        name="alto-url">
                     <parameter name="select"
                                value="concat($url, $url-fragments?alto)"/>
                  </call>
                  <call step="p:variable"
                        name="text-url">
                     <parameter name="select"
                                value="concat($url, $url-fragments?text)"/>
                  </call>
                  <call step="p:variable"
                        name="dc-url">
                     <parameter name="select"
                                value="concat($url, $url-fragments?dc)"/>
                  </call>
                  <call step="p:variable"
                        name="foxml-url">
                     <parameter name="select"
                                value="concat($url, $url-fragments?foxml)"/>
                  </call>
                  <call step="p:variable"
                        name="mods-url">
                     <parameter name="select"
                                value="concat($url, $url-fragments?mods)"/>
                  </call>
                  <call step="p:variable"
                        name="image-url">
                     <parameter name="select"
                                value="concat($url, $url-fragments?image)"/>
                  </call>
                  <call step="lax:get-available-format">
                     <parameter name="url"
                                value="{$alto-url}"/>
                     <parameter name="format"
                                value="alto"/>
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                     <port name="source">
                        <parameter name="select"
                                   value="$page"/>
                     </port>
                  </call>
                  <call step="lax:get-available-format">
                     <parameter name="url"
                                value="{$text-url}"/>
                     <parameter name="format"
                                value="text"/>
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                  </call>
                  <call step="lax:get-available-format">
                     <parameter name="url"
                                value="{$dc-url}"/>
                     <parameter name="format"
                                value="dc"/>
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                  </call>
                  <call step="lax:get-available-format">
                     <parameter name="url"
                                value="{$foxml-url}"/>
                     <parameter name="format"
                                value="foxml"/>
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                  </call>
                  <call step="lax:get-available-format">
                     <parameter name="url"
                                value="{$mods-url}"/>
                     <parameter name="format"
                                value="mods"/>
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                  </call>
                  <call step="lax:get-available-format">
                     <parameter name="url"
                                value="{$image-url}"/>
                     <parameter name="format"
                                value="image"/>
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                  </call>
                  <call step="p:identity"
                        name="page-with-formats"/>
                  <call step="p:variable"
                        name="page-formats">
                     <parameter name="select"
                                value="/*"/>
                  </call>
                  <call step="p:insert">
                     <parameter name="match"
                                value="lad:page"/>
                     <parameter name="position"
                                value="first-child"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="source@getting-available-formats"/>
                     </port>
                     <port name="insertion">
                        <parameter name="select"
                                   value="/lad:page/lad:resource"/>
                        <parameter name="pipe"
                                   value="result@page-with-formats"/>
                     </port>
                  </call>
                  <call step="p:namespace-delete">
                     <parameter name="prefixes"
                                value="array"/>
                  </call>
               </body>
            </step>
            <step type="lax:get-available-format"
                  name="getting-available-format">
               <prolog>
                  <documentation length="247">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get available format</xhtml:h2>
                        <xhtml:p>Checks if the resource is available on-line.</xhtml:p>
                        <xhtml:p>Returns <xhtml:code>&lt;resource&gt;</xhtml:code> with the <xhtml:code>@available</xhtml:code> attribute.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Zjištění dostupnosti formátu</xhtml:h2>
                        <xhtml:p>Zjistí, zda je požadovaný zdroj dostupný on-line.</xhtml:p>
                        <xhtml:p>Vrací element <xhtml:code>&lt;lad:resource&gt;</xhtml:code> s atributem <xhtml:code>@available</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="url"
                             as="xs:anyURI"
                             required="true"/>
                     <option name="format"
                             as="xs:string"
                             required="true"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="247">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get available format</xhtml:h2>
                        <xhtml:p>Checks if the resource is available on-line.</xhtml:p>
                        <xhtml:p>Returns <xhtml:code>&lt;resource&gt;</xhtml:code> with the <xhtml:code>@available</xhtml:code> attribute.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Zjištění dostupnosti formátu</xhtml:h2>
                        <xhtml:p>Zjistí, zda je požadovaný zdroj dostupný on-line.</xhtml:p>
                        <xhtml:p>Vrací element <xhtml:code>&lt;lad:resource&gt;</xhtml:code> s atributem <xhtml:code>@available</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:http-request"
                        name="request">
                     <parameter name="href"
                                value="{$url}"/>
                     <parameter name="parameters"
                                value="map{'status-only' : true(), 'follow-redirect' : 3 }"/>
                  </call>
                  <call step="p:variable"
                        name="available">
                     <parameter name="select"
                                value=".?status-code = (200, 307, 301)"/>
                     <parameter name="pipe"
                                value="report@request"/>
                  </call>
                  <call step="p:add-attribute">
                     <parameter name="attribute-name"
                                value="{$format}"/>
                     <parameter name="attribute-value"
                                value="{$available}"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="source@getting-available-format"/>
                     </port>
                  </call>
                  <call step="p:insert">
                     <parameter name="match"
                                value="lad:page"/>
                     <parameter name="position"
                                value="first-child"/>
                     <port name="insertion"/>
                  </call>
               </body>
            </step>
         </body>
      </library>
   </analysis>
   <analysis file-name="kramerius-7.xpl"
             path="file:///V:/Projekty/Github/MZK/libri-augmentati/src/xproc/kramerius-7.xpl"
             xmlns="https://www.daliboris.cz/ns/xproc/analysis"
             xmlns:xhtml="http://www.w3.org/1999/xhtml">
      <library>
         <prolog>
            <documentation length="166">
               <xhtml:section xml:lang="en"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                              xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                              xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Kramerius 7</xhtml:h1>
                  <xhtml:p>Programming library for communication with the <xhtml:a href="https://system-kramerius.cz/en">Kramerius</xhtml:a> system, <xhtml:a href="https://github.com/ceskaexpedice/kramerius/wiki/API-v7">version 7</xhtml:a>.</xhtml:p>
               </xhtml:section>
               <xhtml:section xml:lang="cs"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                              xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                              xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Kramerius 7</xhtml:h1>
                  <xhtml:p>Programová knihovna pro komunikaci se systémem <xhtml:a href="https://system-kramerius.cz">Kramerius</xhtml:a>, <xhtml:a href="https://github.com/ceskaexpedice/kramerius/wiki/API-v7">verze 7</xhtml:a>.</xhtml:p>
               </xhtml:section>
            </documentation>
            <namespaces>
               <namespace prefix="array"
                          value="http://www.w3.org/2005/xpath-functions/array"/>
               <namespace prefix="lad"
                          value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
               <namespace prefix="las"
                          value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
               <namespace prefix="lax"
                          value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
               <namespace prefix="map"
                          value="http://www.w3.org/2005/xpath-functions/map"/>
               <namespace prefix="p"
                          value="http://www.w3.org/ns/xproc"/>
               <namespace prefix="xhtml"
                          value="http://www.w3.org/1999/xhtml"/>
               <namespace prefix="xlog"
                          value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
               <namespace prefix="xs"
                          value="http://www.w3.org/2001/XMLSchema"/>
               <namespace prefix="xml"
                          value="http://www.w3.org/XML/1998/namespace"/>
            </namespaces>
         </prolog>
         <body>
            <documentation length="166">
               <xhtml:section xml:lang="en"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                              xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                              xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Kramerius 7</xhtml:h1>
                  <xhtml:p>Programming library for communication with the <xhtml:a href="https://system-kramerius.cz/en">Kramerius</xhtml:a> system, <xhtml:a href="https://github.com/ceskaexpedice/kramerius/wiki/API-v7">version 7</xhtml:a>.</xhtml:p>
               </xhtml:section>
               <xhtml:section xml:lang="cs"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                              xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                              xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Kramerius 7</xhtml:h1>
                  <xhtml:p>Programová knihovna pro komunikaci se systémem <xhtml:a href="https://system-kramerius.cz">Kramerius</xhtml:a>, <xhtml:a href="https://github.com/ceskaexpedice/kramerius/wiki/API-v7">verze 7</xhtml:a>.</xhtml:p>
               </xhtml:section>
            </documentation>
            <step type="lax:get-virtual-document-metadata-v7"
                  name="getting-virtual-document-metadata">
               <prolog>
                  <documentation length="495">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get virtual document metadata</xhtml:h2>
                        <xhtml:p>Gathers all requested metadata about the publication. Creates the content of the virtual document with links to all requested resources.</xhtml:p>
                        <xhtml:p>Enhance input data by adding requested resources on the document and page level.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Získání metadat virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Shromáždí všechna požadovaná metadata o publikaci. Vytvoří strukturu virutálního dokumentu s odkazy na všechny požadované zdroje.</xhtml:p>
                        <xhtml:p>Obohatí vstupní data přidáním požadovaných zdrojů na úrovni dokumentu a strany.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="495">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get virtual document metadata</xhtml:h2>
                        <xhtml:p>Gathers all requested metadata about the publication. Creates the content of the virtual document with links to all requested resources.</xhtml:p>
                        <xhtml:p>Enhance input data by adding requested resources on the document and page level.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Získání metadat virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Shromáždí všechna požadovaná metadata o publikaci. Vytvoří strukturu virutálního dokumentu s odkazy na všechny požadované zdroje.</xhtml:p>
                        <xhtml:p>Obohatí vstupní data přidáním požadovaných zdrojů na úrovni dokumentu a strany.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:variable"
                        name="resources">
                     <parameter name="select"
                                value="/lad:document/las:api/las:resource"/>
                  </call>
                  <call step="p:variable"
                        name="library">
                     <parameter name="select"
                                value="/lad:document/las:library"/>
                  </call>
                  <call step="p:variable"
                        name="base-url">
                     <parameter name="select"
                                value="/lad:document/lad:options/@base-url"/>
                  </call>
                  <call step="p:variable"
                        name="id">
                     <parameter name="select"
                                value="replace(/lad:document/@id, ':', '%3A')"/>
                  </call>
                  <call step="p:variable"
                        name="guid">
                     <parameter name="select"
                                value="substring-after(/lad:document/@id, ':')"/>
                  </call>
                  <call step="p:variable"
                        name="url">
                     <parameter name="select"
                                value="concat($base-url, '/search/api/client/v7.0/search?fl=pid,page.number,page.type&amp;sort=rels_ext_index.sort%20asc&amp;rows=4000&amp;start=0&amp;q=own_parent.pid:', '%22', $id, '%22')"/>
                  </call>
                  <call step="p:variable"
                        name="mods-url">
                     <parameter name="select"
                                value="$resources[@type='MODS']/@url ! replace(., '\{pid\}', $id)"/>
                  </call>
                  <call step="p:variable"
                        name="dc-url">
                     <parameter name="select"
                                value="$resources[@type='DC']/@url ! replace(., '\{pid\}', $id)"/>
                  </call>
                  <call step="p:variable"
                        name="foxml-url">
                     <parameter name="select"
                                value="$resources[@type='FOXML']/@url ! replace(., '\{pid\}', $id)"/>
                  </call>
                  <call step="p:insert">
                     <parameter name="match"
                                value="/lad:document"/>
                     <parameter name="position"
                                value="last-child"/>
                     <port name="insertion"/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:store"
                                value=""/>
                  </call>
                  <call step="p:identity"
                        name="document-with-resources"/>
                  <call step="lax:get-virtual-document-pages-v7">
                     <parameter name="url"
                                value="{$url}"/>
                     <parameter name="document-id"
                                value="{$guid}"/>
                     <parameter name="library-code"
                                value="{$library/@code}"/>
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:store"
                                value=""/>
                  </call>
                  <call step="p:identity"
                        name="virutal-pages"/>
                  <call step="p:insert">
                     <parameter name="match"
                                value="lad:document"/>
                     <parameter name="position"
                                value="last-child"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="result@document-with-resources"/>
                     </port>
                     <port name="insertion">
                        <parameter name="pipe"
                                   value="result@virutal-pages"/>
                     </port>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:store"
                                value=""/>
                  </call>
                  <call step="lax:get-available-formats-v7">
                     <parameter name="base-url"
                                value="{$base-url}"/>
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:store"
                                value=""/>
                  </call>
                  <call step="lax:get-source-url-v7">
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                  </call>
                  <call step="p:namespace-delete">
                     <parameter name="prefixes"
                                value="lax xlog array xs map xhtml"/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:store"
                                value=""/>
                  </call>
                  <call step="p:viewport">
                     <parameter name="match"
                                value="lad:page"/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:add-attribute"
                                value=""/>
                     <parameter name="p:viewport"
                                value="&#xA;                        &#xA;        "/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:store"
                                value=""/>
                  </call>
                  <call step="p:insert">
                     <parameter name="match"
                                value="/lad:document"/>
                     <parameter name="position"
                                value="last-child"/>
                     <parameter name="use-when"
                                value="false()"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="result@document-with-resources"/>
                     </port>
                     <port name="insertion">
                        <parameter name="select"
                                   value="/lad:pages"/>
                        <parameter name="pipe"
                                   value="result@pages"/>
                     </port>
                  </call>
               </body>
            </step>
            <step type="lax:get-virtual-document-data-v7"
                  name="getting-virtual-document-data">
               <prolog>
                  <documentation length="490">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get virtual document data</xhtml:h2>
                        <xhtml:p>Gathers all requested data about the publication. Downloads the content (files) of the virtual document from external targets.</xhtml:p>
                        <xhtml:p>Saves data to the disk and enhance input data by adding info about local path of the requested resources.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Získání dat virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Shromáždí všechna požadovaná data publikace. Stáhne obsah (soubory) virutálního dokumentu z externích odkazů.</xhtml:p>
                        <xhtml:p>Uloží data na disk a obohatí vstupní data přidáním informace o lokálním uložení zdrojů.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="490">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get virtual document data</xhtml:h2>
                        <xhtml:p>Gathers all requested data about the publication. Downloads the content (files) of the virtual document from external targets.</xhtml:p>
                        <xhtml:p>Saves data to the disk and enhance input data by adding info about local path of the requested resources.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Získání dat virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Shromáždí všechna požadovaná data publikace. Stáhne obsah (soubory) virutálního dokumentu z externích odkazů.</xhtml:p>
                        <xhtml:p>Uloží data na disk a obohatí vstupní data přidáním informace o lokálním uložení zdrojů.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:variable"
                        name="base-url">
                     <parameter name="select"
                                value="/lad:document/lad:options/@base-url"/>
                  </call>
                  <call step="p:variable"
                        name="id">
                     <parameter name="select"
                                value="/lad:document/@id"/>
                  </call>
                  <call step="p:variable"
                        name="guid">
                     <parameter name="select"
                                value="substring-after(/lad:document/@id, ':')"/>
                  </call>
                  <call step="p:variable"
                        name="url">
                     <parameter name="select"
                                value="concat($base-url, '/item/', $id, '/children')"/>
                  </call>
               </body>
            </step>
            <step type="lax:get-virtual-document-pages-v7">
               <prolog>
                  <documentation length="329">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get virtual document pages</xhtml:h2>
                        <xhtml:p>Creates element for each page of the document that contains basic data: identifier, type and (page) number.</xhtml:p>
                        <xhtml:p>Returns element <xhtml:code>&lt;lad:pages&gt;</xhtml:code>
                        </xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Získání stránek virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Pro každou stránku dokumentu vytvoří element se základními údaji: identifikátor, typ a číslo (strany).</xhtml:p>
                        <xhtml:p>Vrací element <xhtml:code>&lt;lad:pages&gt;</xhtml:code>
                        </xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="url"
                             as="xs:string"
                             required="true"/>
                     <option name="document-id"
                             as="xs:string"
                             required="true"/>
                     <option name="library-code"
                             as="xs:string"
                             required="true"/>
                  </options>
                  <ports>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="329">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get virtual document pages</xhtml:h2>
                        <xhtml:p>Creates element for each page of the document that contains basic data: identifier, type and (page) number.</xhtml:p>
                        <xhtml:p>Returns element <xhtml:code>&lt;lad:pages&gt;</xhtml:code>
                        </xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Získání stránek virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Pro každou stránku dokumentu vytvoří element se základními údaji: identifikátor, typ a číslo (strany).</xhtml:p>
                        <xhtml:p>Vrací element <xhtml:code>&lt;lad:pages&gt;</xhtml:code>
                        </xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:try">
                     <parameter name="p:group"
                                value="&#xA;            &#xA;                &#xA;            &#xA;            &#xA;            &#xA;                &#xA;            &#xA;&#xA;            &#xA;&#xA;        "/>
                     <parameter name="p:catch"
                                value="&#xA;            &#xA;                &#xA;            &#xA;               &#xA;        "/>
                  </call>
               </body>
            </step>
            <step type="lax:pages-convert-json-to-xml-v7">
               <prolog>
                  <documentation length="387">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Pages: convert JSON to XML</xhtml:h2>
                        <xhtml:p>Converts from JSON to XML data about the document page. Creates element for the page with basic data: identifier, type and (page) number.</xhtml:p>
                        <xhtml:p>Returns <xhtml:code>&lt;lad:page&gt;</xhtml:code> element.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Strany: konverze JSONu na XML</xhtml:h2>
                        <xhtml:p>Zkonvertuje údje o stránce z JSONu do XML. Vytvoří element pro stránku dokumentu se základními údaji: identifikátor, typ a číslo (strany).</xhtml:p>
                        <xhtml:p>Vrací element <xhtml:code>&lt;lad:page&gt;</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="387">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Pages: convert JSON to XML</xhtml:h2>
                        <xhtml:p>Converts from JSON to XML data about the document page. Creates element for the page with basic data: identifier, type and (page) number.</xhtml:p>
                        <xhtml:p>Returns <xhtml:code>&lt;lad:page&gt;</xhtml:code> element.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Strany: konverze JSONu na XML</xhtml:h2>
                        <xhtml:p>Zkonvertuje údje o stránce z JSONu do XML. Vytvoří element pro stránku dokumentu se základními údaji: identifikátor, typ a číslo (strany).</xhtml:p>
                        <xhtml:p>Vrací element <xhtml:code>&lt;lad:page&gt;</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:for-each">
                     <port name="anonymous">
                        <parameter name="select"
                                   value=".?response?docs?*"/>
                     </port>
                  </call>
                  <call step="p:wrap-sequence">
                     <parameter name="wrapper"
                                value="lad:pages"/>
                  </call>
               </body>
            </step>
            <step type="lax:get-source-url-v7">
               <prolog>
                  <documentation length="371">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get source URL</xhtml:h2>
                        <xhtml:p>For a resource associated with a page, builds a URL from the base URL, API version, document identifier, etc.</xhtml:p>
                        <xhtml:p>Creates <xhtml:code>@url</xhtml:code> attribute for the <xhtml:code>&lt;lad:page&gt;</xhtml:code> element.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Sestavení URL zdroje</xhtml:h2>
                        <xhtml:p>Pro zdroj přiřazený ke stránce sestaví adresu URL ze základní adresy URL, verze rozhraní API, identifikátoru dokumentu apod.</xhtml:p>
                        <xhtml:p>Vytvoří atribut <xhtml:code>@url</xhtml:code> v rámci elementu <xhtml:code>&lt;lad:page&gt;</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="371">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get source URL</xhtml:h2>
                        <xhtml:p>For a resource associated with a page, builds a URL from the base URL, API version, document identifier, etc.</xhtml:p>
                        <xhtml:p>Creates <xhtml:code>@url</xhtml:code> attribute for the <xhtml:code>&lt;lad:page&gt;</xhtml:code> element.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Sestavení URL zdroje</xhtml:h2>
                        <xhtml:p>Pro zdroj přiřazený ke stránce sestaví adresu URL ze základní adresy URL, verze rozhraní API, identifikátoru dokumentu apod.</xhtml:p>
                        <xhtml:p>Vytvoří atribut <xhtml:code>@url</xhtml:code> v rámci elementu <xhtml:code>&lt;lad:page&gt;</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:variable"
                        name="options">
                     <parameter name="select"
                                value="/lad:document/lad:options"/>
                  </call>
                  <call step="p:variable"
                        name="resources">
                     <parameter name="select"
                                value="/lad:document/las:api/las:resource"/>
                  </call>
                  <call step="p:viewport">
                     <parameter name="match"
                                value="lad:page"/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:viewport"
                                value="&#xA;             &#xA;             &#xA;             &#xA;             &#xA;             &#xA;         "/>
                  </call>
               </body>
            </step>
            <step type="lax:get-available-formats-v7"
                  name="getting-available-formats">
               <prolog>
                  <documentation length="378">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get available formats</xhtml:h2>
                        <xhtml:p>Selects one page from the middle of the document and checks which resources are available on-line.</xhtml:p>
                        <xhtml:p>For each requested <xhtml:code>&lt;resource&gt;</xhtml:code> adds <xhtml:code>@available</xhtml:code> attribute.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Zjištění dostupných formátů</xhtml:h2>
                        <xhtml:p>Pro stránku zprostředka publikace zjistí, které všechny zdroje jsou dostupné on-line.</xhtml:p>
                        <xhtml:p>Pro každý požadovaný zdroj vytvoří atribut <xhtml:code>@available</xhtml:code> v rámci elementu <xhtml:code>&lt;lad:resource&gt;</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="base-url"
                             as="xs:anyURI"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="378">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get available formats</xhtml:h2>
                        <xhtml:p>Selects one page from the middle of the document and checks which resources are available on-line.</xhtml:p>
                        <xhtml:p>For each requested <xhtml:code>&lt;resource&gt;</xhtml:code> adds <xhtml:code>@available</xhtml:code> attribute.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Zjištění dostupných formátů</xhtml:h2>
                        <xhtml:p>Pro stránku zprostředka publikace zjistí, které všechny zdroje jsou dostupné on-line.</xhtml:p>
                        <xhtml:p>Pro každý požadovaný zdroj vytvoří atribut <xhtml:code>@available</xhtml:code> v rámci elementu <xhtml:code>&lt;lad:resource&gt;</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="size">
                     <parameter name="select"
                                value="count(/lad:document/lad:pages/lad:page)"/>
                     <parameter name="as"
                                value="xs:integer"/>
                  </call>
                  <call step="p:variable"
                        name="page">
                     <parameter name="select"
                                value="/lad:document/lad:pages/lad:page[xs:integer($size div 2)]"/>
                  </call>
                  <call step="p:variable"
                        name="options">
                     <parameter name="select"
                                value="/lad:document/lad:options"/>
                  </call>
                  <call step="p:variable"
                        name="resources">
                     <parameter name="select"
                                value="/lad:document/las:api/las:resource[tokenize(@level) = 'page'][@type=tokenize($options/@page-resources)]"/>
                  </call>
                  <call step="p:for-each">
                     <port name="anonymous">
                        <parameter name="select"
                                   value="$resources"/>
                     </port>
                  </call>
                  <call step="p:insert">
                     <parameter name="match"
                                value="lad:page"/>
                     <parameter name="position"
                                value="first-child"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="source@getting-available-formats"/>
                     </port>
                     <port name="insertion">
                        <parameter name="pipe"
                                   value="result@available-resources"/>
                     </port>
                  </call>
                  <call step="p:namespace-delete">
                     <parameter name="prefixes"
                                value="array"/>
                  </call>
               </body>
            </step>
            <step type="lax:get-available-format-v7"
                  name="getting-available-format">
               <prolog>
                  <documentation length="247">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get available format</xhtml:h2>
                        <xhtml:p>Checks if the resource is available on-line.</xhtml:p>
                        <xhtml:p>Returns <xhtml:code>&lt;resource&gt;</xhtml:code> with the <xhtml:code>@available</xhtml:code> attribute.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Zjištění dostupnosti formátu</xhtml:h2>
                        <xhtml:p>Zjistí, zda je požadovaný zdroj dostupný on-line.</xhtml:p>
                        <xhtml:p>Vrací element <xhtml:code>&lt;lad:resource&gt;</xhtml:code> s atributem <xhtml:code>@available</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="url"
                             as="xs:anyURI"
                             required="true"/>
                     <option name="format"
                             as="xs:string"
                             required="true"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="247">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get available format</xhtml:h2>
                        <xhtml:p>Checks if the resource is available on-line.</xhtml:p>
                        <xhtml:p>Returns <xhtml:code>&lt;resource&gt;</xhtml:code> with the <xhtml:code>@available</xhtml:code> attribute.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Zjištění dostupnosti formátu</xhtml:h2>
                        <xhtml:p>Zjistí, zda je požadovaný zdroj dostupný on-line.</xhtml:p>
                        <xhtml:p>Vrací element <xhtml:code>&lt;lad:resource&gt;</xhtml:code> s atributem <xhtml:code>@available</xhtml:code>.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:http-request"
                        name="request">
                     <parameter name="href"
                                value="{$url}"/>
                     <parameter name="parameters"
                                value="map{'status-only' : true(), 'follow-redirect' : 3 }"/>
                     <parameter name="assert"
                                value=".?status-code lt 500"/>
                  </call>
                  <call step="p:variable"
                        name="available">
                     <parameter name="select"
                                value=".?status-code = (200, 307, 301)"/>
                     <parameter name="pipe"
                                value="report@request"/>
                  </call>
                  <call step="p:add-attribute">
                     <parameter name="attribute-name"
                                value="{$format}"/>
                     <parameter name="attribute-value"
                                value="{$available}"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="source@getting-available-format"/>
                     </port>
                  </call>
                  <call step="p:insert">
                     <parameter name="match"
                                value="lad:page"/>
                     <parameter name="position"
                                value="first-child"/>
                     <parameter name="use-when"
                                value="false()"/>
                     <port name="insertion"/>
                  </call>
                  <call step="p:identity">
                     <port name="source"/>
                  </call>
               </body>
            </step>
         </body>
      </library>
   </analysis>
   <analysis file-name="libri-augmentati.xpl"
             path="file:///V:/Projekty/Github/MZK/libri-augmentati/src/xproc/libri-augmentati.xpl"
             xmlns="https://www.daliboris.cz/ns/xproc/analysis"
             xmlns:xhtml="http://www.w3.org/1999/xhtml">
      <library>
         <prolog>
            <documentation length="199">
               <xhtml:section xml:lang="en"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:mods="http://www.loc.gov/mods/v3"
                              xmlns:err="http://www.w3.org/ns/xproc-error"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                              xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                              xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                              xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                              xmlns:mox="http://www.xml-project.com/morganaxproc"
                              xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                              xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                              xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Libri augmentati</xhtml:h1>
                  <xhtml:p>The main programming library for digital library data retrieval and enrichment.</xhtml:p>
               </xhtml:section>
               <xhtml:section xml:lang="cs"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:mods="http://www.loc.gov/mods/v3"
                              xmlns:err="http://www.w3.org/ns/xproc-error"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                              xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                              xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                              xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                              xmlns:mox="http://www.xml-project.com/morganaxproc"
                              xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                              xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                              xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Libri augmentati</xhtml:h1>
                  <xhtml:p>Hlavní programová knihovna pro získání dat z digitálních knihoven a jejich obohacení.</xhtml:p>
               </xhtml:section>
            </documentation>
            <namespaces>
               <namespace prefix="array"
                          value="http://www.w3.org/2005/xpath-functions/array"/>
               <namespace prefix="c"
                          value="http://www.w3.org/ns/xproc-step"/>
               <namespace prefix="err"
                          value="http://www.w3.org/ns/xproc-error"/>
               <namespace prefix="lac"
                          value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
               <namespace prefix="lad"
                          value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
               <namespace prefix="lae"
                          value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
               <namespace prefix="lap"
                          value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
               <namespace prefix="lar"
                          value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
               <namespace prefix="las"
                          value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
               <namespace prefix="lax"
                          value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
               <namespace prefix="map"
                          value="http://www.w3.org/2005/xpath-functions/map"/>
               <namespace prefix="mods"
                          value="http://www.loc.gov/mods/v3"/>
               <namespace prefix="mox"
                          value="http://www.xml-project.com/morganaxproc"/>
               <namespace prefix="p"
                          value="http://www.w3.org/ns/xproc"/>
               <namespace prefix="xhtml"
                          value="http://www.w3.org/1999/xhtml"/>
               <namespace prefix="xlog"
                          value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
               <namespace prefix="xs"
                          value="http://www.w3.org/2001/XMLSchema"/>
               <namespace prefix="xml"
                          value="http://www.w3.org/XML/1998/namespace"/>
            </namespaces>
            <imports/>
            <options/>
         </prolog>
         <body>
            <documentation length="199">
               <xhtml:section xml:lang="en"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:mods="http://www.loc.gov/mods/v3"
                              xmlns:err="http://www.w3.org/ns/xproc-error"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                              xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                              xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                              xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                              xmlns:mox="http://www.xml-project.com/morganaxproc"
                              xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                              xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                              xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Libri augmentati</xhtml:h1>
                  <xhtml:p>The main programming library for digital library data retrieval and enrichment.</xhtml:p>
               </xhtml:section>
               <xhtml:section xml:lang="cs"
                              xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                              xmlns:mods="http://www.loc.gov/mods/v3"
                              xmlns:err="http://www.w3.org/ns/xproc-error"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                              xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                              xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                              xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                              xmlns:mox="http://www.xml-project.com/morganaxproc"
                              xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                              xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                              xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                  <xhtml:h1>Libri augmentati</xhtml:h1>
                  <xhtml:p>Hlavní programová knihovna pro získání dat z digitálních knihoven a jejich obohacení.</xhtml:p>
               </xhtml:section>
            </documentation>
            <step type="lax:build-virtual-document"
                  name="building-virtual-document">
               <prolog>
                  <documentation length="321">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Build virtual document</xhtml:h2>
                        <xhtml:p>Gathers all requested metadata about the publication. Creates the content of the virtual document with links to all requested resources.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Sestavení virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Shromáždí všechna požadovaná metadata o publikaci. Vytvoří strukturu virutálního dokumentu s odkazy na všechny požadované zdroje.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="c"
                                value="http://www.w3.org/ns/xproc-step"/>
                     <namespace prefix="err"
                                value="http://www.w3.org/ns/xproc-error"/>
                     <namespace prefix="lac"
                                value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lae"
                                value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
                     <namespace prefix="lap"
                                value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
                     <namespace prefix="lar"
                                value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="mods"
                                value="http://www.loc.gov/mods/v3"/>
                     <namespace prefix="mox"
                                value="http://www.xml-project.com/morganaxproc"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="library-code"
                             as="xs:string"
                             required="true"/>
                     <option name="api-version"
                             as="xs:string?"/>
                     <option name="system"
                             as="xs:string?"
                             values="('Kramerius', 'Polona')"
                             required="false"/>
                     <option name="document-resources"
                             as="xs:token*"/>
                     <option name="page-resources"
                             as="xs:token*"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <input port="settings"/>
                     <input port="report-in"/>
                     <output port="result"
                             primary="true"
                             sequence="true"/>
                     <output port="report"
                             primary="false"
                             sequence="false"
                             pipe="report-in@building-virtual-document"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="321">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Build virtual document</xhtml:h2>
                        <xhtml:p>Gathers all requested metadata about the publication. Creates the content of the virtual document with links to all requested resources.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Sestavení virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Shromáždí všechna požadovaná metadata o publikaci. Vytvoří strukturu virutálního dokumentu s odkazy na všechny požadované zdroje.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:variable"
                        name="library">
                     <parameter name="select"
                                value="/las:digital-libraries/las:libraries/las:library[@code=$library-code]"/>
                     <parameter name="pipe"
                                value="settings@building-virtual-document"/>
                  </call>
                  <call step="p:variable"
                        name="apis">
                     <parameter name="select"
                                value="/las:digital-libraries/las:apis/las:api"/>
                     <parameter name="pipe"
                                value="settings@building-virtual-document"/>
                  </call>
                  <call step="p:variable"
                        name="api">
                     <parameter name="select"
                                value="let $lib-apis := $apis[@xml:id =$library/las:api/@ref/substring-after(., '#')] return if(exists($api-version)) then $lib-apis[@version=$api-version] else $lib-apis[1] "/>
                  </call>
                  <call step="p:variable"
                        name="base-url">
                     <parameter name="select"
                                value="$library/las:api[@ref=concat('#', $api/@xml:id)]/@url"/>
                  </call>
                  <call step="p:identity"
                        name="options">
                     <port name="anonymous"/>
                  </call>
                  <call step="p:for-each">
                     <port name="anonymous">
                        <parameter name="select"
                                   value="/lad:documents/lad:document"/>
                        <parameter name="pipe"
                                   value="source@building-virtual-document"/>
                     </port>
                  </call>
               </body>
            </step>
            <step type="lax:get-virtual-document-metadata"
                  name="getting-virtual-document-metadata">
               <prolog>
                  <documentation length="506">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get virtual document metadata</xhtml:h2>
                        <xhtml:p>Gathers all requested metadata about the publication. Downloads the content (files) of the virtual document from external targets.</xhtml:p>
                        <xhtml:p>Saves data to the disk and enhance input data by adding info about local path of the requested resources.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Získání metadat virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Shromáždí všechna požadovaná metadata publikace. Stáhne obsah (soubory) virutálního dokumentu z externích odkazů.</xhtml:p>
                        <xhtml:p>Uloží data na disk a obohatí vstupní data přidáním informace o lokálním uložení zdrojů.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="c"
                                value="http://www.w3.org/ns/xproc-step"/>
                     <namespace prefix="err"
                                value="http://www.w3.org/ns/xproc-error"/>
                     <namespace prefix="lac"
                                value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lae"
                                value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
                     <namespace prefix="lap"
                                value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
                     <namespace prefix="lar"
                                value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="mods"
                                value="http://www.loc.gov/mods/v3"/>
                     <namespace prefix="mox"
                                value="http://www.xml-project.com/morganaxproc"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <input port="report-in"/>
                     <output port="result"
                             primary="true"/>
                     <output port="report"
                             primary="false"
                             sequence="false"
                             pipe="report-in@getting-virtual-document-metadata"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="506">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get virtual document metadata</xhtml:h2>
                        <xhtml:p>Gathers all requested metadata about the publication. Downloads the content (files) of the virtual document from external targets.</xhtml:p>
                        <xhtml:p>Saves data to the disk and enhance input data by adding info about local path of the requested resources.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Získání metadat virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Shromáždí všechna požadovaná metadata publikace. Stáhne obsah (soubory) virutálního dokumentu z externích odkazů.</xhtml:p>
                        <xhtml:p>Uloží data na disk a obohatí vstupní data přidáním informace o lokálním uložení zdrojů.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:variable"
                        name="api-version">
                     <parameter name="select"
                                value="/lad:document/lad:options/@api-version"/>
                  </call>
                  <call step="p:variable"
                        name="system">
                     <parameter name="select"
                                value="/lad:document/lad:options/@system"/>
                  </call>
                  <call step="p:variable"
                        name="library-code">
                     <parameter name="select"
                                value="/lad:document/las:library/@code"/>
                  </call>
                  <call step="p:variable"
                        name="library">
                     <parameter name="select"
                                value="/lad:document/las:library"/>
                  </call>
                  <call step="p:choose"
                        length="1"/>
                  <call step="p:namespace-delete">
                     <parameter name="prefixes"
                                value="c xs map mox array"/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:store"
                                value=""/>
                  </call>
               </body>
            </step>
            <step type="lax:download-document-data"
                  name="downloading-document-data">
               <prolog>
                  <documentation length="511">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Download document data</xhtml:h2>
                        <xhtml:p>Gathers all requested data and metadata about the publication. Downloads the content (files) of the virtual document from external targets.</xhtml:p>
                        <xhtml:p>Saves data to the disk and enhance input data by adding info about local path of the requested resources.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Stažení dat virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Shromáždí všechna požadovaná data a metadata publikace. Stáhne obsah (soubory) virutálního dokumentu z externích odkazů.</xhtml:p>
                        <xhtml:p>Uloží data na disk a obohatí vstupní data přidáním informace o lokálním uložení zdrojů.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="c"
                                value="http://www.w3.org/ns/xproc-step"/>
                     <namespace prefix="err"
                                value="http://www.w3.org/ns/xproc-error"/>
                     <namespace prefix="lac"
                                value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lae"
                                value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
                     <namespace prefix="lap"
                                value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
                     <namespace prefix="lar"
                                value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="mods"
                                value="http://www.loc.gov/mods/v3"/>
                     <namespace prefix="mox"
                                value="http://www.xml-project.com/morganaxproc"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="output-directory"
                             required="true"
                             as="xs:string"/>
                     <option name="pause-before-request"
                             select="2"
                             as="xs:integer"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"
                            sequence="true"/>
                     <input port="report-in"
                            sequence="true"/>
                     <output port="result"
                             primary="true"
                             sequence="true"/>
                     <output port="report"
                             primary="false"
                             sequence="false"
                             pipe="report-in@downloading-document-data"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="511">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Download document data</xhtml:h2>
                        <xhtml:p>Gathers all requested data and metadata about the publication. Downloads the content (files) of the virtual document from external targets.</xhtml:p>
                        <xhtml:p>Saves data to the disk and enhance input data by adding info about local path of the requested resources.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Stažení dat virtuálního dokumentu</xhtml:h2>
                        <xhtml:p>Shromáždí všechna požadovaná data a metadata publikace. Stáhne obsah (soubory) virutálního dokumentu z externích odkazů.</xhtml:p>
                        <xhtml:p>Uloží data na disk a obohatí vstupní data přidáním informace o lokálním uložení zdrojů.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:viewport">
                     <parameter name="match"
                                value="lad:document"/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:viewport"
                                value="&#xA;    &#xA;    &#xA;    &#xA;     &#xA;    &#xA;   "/>
                     <parameter name="p:viewport"
                                value="&#xA;    &#xA;    &#xA;    &#xA;    &#xA;     &#xA;    &#xA;   "/>
                  </call>
                  <call step="p:viewport">
                     <parameter name="match"
                                value="lad:document"/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:if"
                                value="&#xA;     &#xA;   "/>
                     <parameter name="p:if"
                                value="&#xA;     &#xA;   "/>
                  </call>
               </body>
            </step>
            <step type="lax:download-document-resources">
               <prolog>
                  <documentation length="398">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Download document resources</xhtml:h2>
                        <xhtml:p>Downloads the content (files) of the document-related resources from external targets.</xhtml:p>
                        <xhtml:p>Saves data to the disk and enhance input data by adding info about local path of the requested resources.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Stažení zdrojů dokumentu</xhtml:h2>
                        <xhtml:p>Stáhne obsah (soubory) virutálního dokumentu z externích odkazů.</xhtml:p>
                        <xhtml:p>Uloží data na disk a obohatí vstupní data přidáním informace o lokálním uložení zdrojů.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="c"
                                value="http://www.w3.org/ns/xproc-step"/>
                     <namespace prefix="err"
                                value="http://www.w3.org/ns/xproc-error"/>
                     <namespace prefix="lac"
                                value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lae"
                                value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
                     <namespace prefix="lap"
                                value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
                     <namespace prefix="lar"
                                value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="mods"
                                value="http://www.loc.gov/mods/v3"/>
                     <namespace prefix="mox"
                                value="http://www.xml-project.com/morganaxproc"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="output-directory"
                             required="true"
                             as="xs:string"/>
                     <option name="position"
                             required="true"/>
                     <option name="type"
                             required="true"
                             as="xs:string"/>
                     <option name="pause-before-request"
                             required="true"
                             as="xs:integer"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"
                            sequence="true"/>
                     <output port="result"
                             primary="true"
                             sequence="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="398">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Download document resources</xhtml:h2>
                        <xhtml:p>Downloads the content (files) of the document-related resources from external targets.</xhtml:p>
                        <xhtml:p>Saves data to the disk and enhance input data by adding info about local path of the requested resources.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Stažení zdrojů dokumentu</xhtml:h2>
                        <xhtml:p>Stáhne obsah (soubory) virutálního dokumentu z externích odkazů.</xhtml:p>
                        <xhtml:p>Uloží data na disk a obohatí vstupní data přidáním informace o lokálním uložení zdrojů.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:variable"
                        name="output-directory-uri">
                     <parameter name="select"
                                value="resolve-uri($output-directory, $base-uri)"/>
                  </call>
                  <call step="p:viewport">
                     <parameter name="match"
                                value="lad:resource"/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:set-attributes"
                                value=""/>
                     <parameter name="lax:check-local-file-exists"
                                value=""/>
                     <parameter name="p:variable"
                                value=""/>
                     <parameter name="p:if"
                                value="&#xA;    &#xA;   "/>
                     <parameter name="lax:check-local-file-exists"
                                value="&#xA;    &#xA;   "/>
                  </call>
               </body>
            </step>
            <step type="lax:check-local-file-exists"
                  name="checking-local-file-exists">
               <prolog>
                  <documentation length="164">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Check local file exists</xhtml:h2>
                        <xhtml:p>Checks if the file is stored on the local computer.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Zjištění existence místního souboru</xhtml:h2>
                        <xhtml:p>Zjistí, jestli je soubor stažen na místním počítači.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="c"
                                value="http://www.w3.org/ns/xproc-step"/>
                     <namespace prefix="err"
                                value="http://www.w3.org/ns/xproc-error"/>
                     <namespace prefix="lac"
                                value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lae"
                                value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
                     <namespace prefix="lap"
                                value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
                     <namespace prefix="lar"
                                value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="mods"
                                value="http://www.loc.gov/mods/v3"/>
                     <namespace prefix="mox"
                                value="http://www.xml-project.com/morganaxproc"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="164">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Check local file exists</xhtml:h2>
                        <xhtml:p>Checks if the file is stored on the local computer.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Zjištění existence místního souboru</xhtml:h2>
                        <xhtml:p>Zjistí, jestli je soubor stažen na místním počítači.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:variable"
                        name="local-path">
                     <parameter name="select"
                                value="/*/@local-uri"/>
                  </call>
                  <call step="p:file-info">
                     <parameter name="href"
                                value="{$local-path}"/>
                     <parameter name="fail-on-error"
                                value="false"/>
                  </call>
                  <call step="p:variable"
                        name="file-exists">
                     <parameter name="select"
                                value="exists(/c:file)"/>
                  </call>
                  <call step="p:add-attribute">
                     <parameter name="attribute-name"
                                value="local-file-exists"/>
                     <parameter name="attribute-value"
                                value="{$file-exists}"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="source@checking-local-file-exists"/>
                     </port>
                  </call>
               </body>
            </step>
            <step type="lax:download-document-data-items">
               <prolog>
                  <documentation length="28">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Download document data items</xhtml:h2>
                        <xhtml:p/>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="c"
                                value="http://www.w3.org/ns/xproc-step"/>
                     <namespace prefix="err"
                                value="http://www.w3.org/ns/xproc-error"/>
                     <namespace prefix="lac"
                                value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lae"
                                value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
                     <namespace prefix="lap"
                                value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
                     <namespace prefix="lar"
                                value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="mods"
                                value="http://www.loc.gov/mods/v3"/>
                     <namespace prefix="mox"
                                value="http://www.xml-project.com/morganaxproc"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="output-directory"
                             required="true"/>
                     <option name="type"
                             required="true"
                             as="xs:string"/>
                     <option name="pause-before-request"
                             required="true"
                             as="xs:integer"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"
                            sequence="true"/>
                     <output port="result"
                             primary="true"
                             sequence="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="28">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Download document data items</xhtml:h2>
                        <xhtml:p/>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <call step="p:for-each">
                     <port name="anonymous">
                        <parameter name="select"
                                   value="."/>
                     </port>
                  </call>
               </body>
            </step>
            <step type="lax:download-document">
               <prolog>
                  <documentation length="17">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Download document</xhtml:h2>
                        <xhtml:p/>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="c"
                                value="http://www.w3.org/ns/xproc-step"/>
                     <namespace prefix="err"
                                value="http://www.w3.org/ns/xproc-error"/>
                     <namespace prefix="lac"
                                value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lae"
                                value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
                     <namespace prefix="lap"
                                value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
                     <namespace prefix="lar"
                                value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="mods"
                                value="http://www.loc.gov/mods/v3"/>
                     <namespace prefix="mox"
                                value="http://www.xml-project.com/morganaxproc"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="url"
                             as="xs:anyURI"/>
                     <option name="local-path"
                             as="xs:string"/>
                     <option name="pause-before-request"
                             required="true"
                             as="xs:integer"/>
                  </options>
                  <ports>
                     <input port="source"
                            sequence="true"/>
                     <output port="result"
                             primary="true"
                             sequence="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="17">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Download document</xhtml:h2>
                        <xhtml:p/>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="content-type">
                     <parameter name="select"
                                value="if(ends-with($url, '.txt')) then 'text/plain' else if(ends-with($url, '.djvu')) then 'image/vnd.djvu' else '*/*'"/>
                  </call>
                  <call step="p:variable"
                        name="local-path-uri">
                     <parameter name="select"
                                value="resolve-uri($local-path, $base-uri)"/>
                  </call>
                  <call step="p:try">
                     <parameter name="p:http-request"
                                value=""/>
                     <parameter name="p:store"
                                value=""/>
                     <parameter name="p:catch"
                                value="&#xA;    &#xA;    &#xA;     &#xA;      File {$url} not downloaded&#xA;     &#xA;    &#xA;   "/>
                     <parameter name="p:catch"
                                value="&#xA;    &#xA;    &#xA;     &#xA;      File {$url} not downloaded&#xA;     &#xA;    &#xA;   "/>
                  </call>
               </body>
            </step>
            <step type="lax:enrich-document-data"
                  name="enriching-document-data">
               <prolog>
                  <documentation length="208">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Enrich document data</xhtml:h2>
                        <xhtml:p>Enriches available (textual) data of the digital book by available services.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Obohacení dat dokumentu</xhtml:h2>
                        <xhtml:p>Obohatí dostupná dostupná (textová) data digitální publikací pomocí dostupných služeb.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="c"
                                value="http://www.w3.org/ns/xproc-step"/>
                     <namespace prefix="err"
                                value="http://www.w3.org/ns/xproc-error"/>
                     <namespace prefix="lac"
                                value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lae"
                                value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
                     <namespace prefix="lap"
                                value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
                     <namespace prefix="lar"
                                value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="mods"
                                value="http://www.loc.gov/mods/v3"/>
                     <namespace prefix="mox"
                                value="http://www.xml-project.com/morganaxproc"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="output-directory"
                             required="true"
                             as="xs:string"/>
                     <option name="pause-before-request"
                             select="2"
                             as="xs:integer"/>
                     <option name="output-format"
                             values="('TEXT', 'TEI')"
                             as="xs:string*"/>
                     <option name="enrichment"
                             values="('ENTITIES', 'MORPHOLOGY')"
                             as="xs:string*"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"
                            sequence="true"/>
                     <input port="settings"
                            primary="false"/>
                     <input port="report-in"
                            sequence="true"/>
                     <output port="result"
                             primary="true"
                             sequence="true"/>
                     <output port="report"
                             pipe="report-in@enriching-document-data"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="208">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Enrich document data</xhtml:h2>
                        <xhtml:p>Enriches available (textual) data of the digital book by available services.</xhtml:p>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Obohacení dat dokumentu</xhtml:h2>
                        <xhtml:p>Obohatí dostupná dostupná (textová) data digitální publikací pomocí dostupných služeb.</xhtml:p>
                     </xhtml:section>
                  </documentation>
                  <call step="lae:enrich-data">
                     <parameter name="output-directory"
                                value="{$output-directory}"/>
                     <parameter name="debug-path"
                                value="{$debug-path}"/>
                     <parameter name="base-uri"
                                value="{$base-uri}"/>
                     <parameter name="output-format"
                                value="$output-format"/>
                     <parameter name="enrichment"
                                value="$enrichment"/>
                     <port name="settings">
                        <parameter name="pipe"
                                   value="settings@enriching-document-data"/>
                     </port>
                     <port name="report-in">
                        <parameter name="pipe"
                                   value="report-in@enriching-document-data"/>
                     </port>
                  </call>
               </body>
            </step>
            <step type="lax:create-report"
                  name="creating-report">
               <prolog>
                  <documentation length="13">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Create report</xhtml:h2>
                        <xhtml:p/>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="c"
                                value="http://www.w3.org/ns/xproc-step"/>
                     <namespace prefix="err"
                                value="http://www.w3.org/ns/xproc-error"/>
                     <namespace prefix="lac"
                                value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lae"
                                value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
                     <namespace prefix="lap"
                                value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
                     <namespace prefix="lar"
                                value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="mods"
                                value="http://www.loc.gov/mods/v3"/>
                     <namespace prefix="mox"
                                value="http://www.xml-project.com/morganaxproc"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="output-directory"
                             select="()"
                             as="xs:string?"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"
                            sequence="true"/>
                     <output port="result"
                             primary="true"
                             sequence="true"
                             pipe="result@documents-loop"/>
                     <output port="result-uri"
                             primary="false"
                             sequence="true"
                             pipe="result-uri@documents-loop"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="13">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Create report</xhtml:h2>
                        <xhtml:p/>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:variable"
                        name="save-output">
                     <parameter name="select"
                                value="$output-directory || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="output-directory-uri">
                     <parameter name="select"
                                value="resolve-uri($output-directory, $base-uri)"/>
                  </call>
                  <call step="p:for-each">
                     <port name="anonymous">
                        <parameter name="select"
                                   value="/*"/>
                     </port>
                  </call>
               </body>
            </step>
            <step type="lax:get-document-id">
               <prolog>
                  <documentation length="15">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get document id</xhtml:h2>
                        <xhtml:p/>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="array"
                                value="http://www.w3.org/2005/xpath-functions/array"/>
                     <namespace prefix="c"
                                value="http://www.w3.org/ns/xproc-step"/>
                     <namespace prefix="err"
                                value="http://www.w3.org/ns/xproc-error"/>
                     <namespace prefix="lac"
                                value="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lae"
                                value="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"/>
                     <namespace prefix="lap"
                                value="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"/>
                     <namespace prefix="lar"
                                value="https://www.mzk.cz/ns/libri-augmentati/report/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="lax"
                                value="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"/>
                     <namespace prefix="map"
                                value="http://www.w3.org/2005/xpath-functions/map"/>
                     <namespace prefix="mods"
                                value="http://www.loc.gov/mods/v3"/>
                     <namespace prefix="mox"
                                value="http://www.xml-project.com/morganaxproc"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xlog"
                                value="https://www.daliboris.cz/ns/xproc/logging/1.0"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <ports>
                     <input port="source"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="15">
                     <xhtml:section xml:lang="en"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2>Get document id</xhtml:h2>
                        <xhtml:p/>
                     </xhtml:section>
                     <xhtml:section xml:lang="cs"
                                    xmlns:lax="https://www.mzk.cz/ns/libri-augmentati/xproc/1.0"
                                    xmlns:mods="http://www.loc.gov/mods/v3"
                                    xmlns:err="http://www.w3.org/ns/xproc-error"
                                    xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                                    xmlns:lac="https://www.mzk.cz/ns/libri-augmentati/conversion/1.0"
                                    xmlns:lae="https://www.mzk.cz/ns/libri-augmentati/enrichment/1.0"
                                    xmlns:xlog="https://www.daliboris.cz/ns/xproc/logging/1.0"
                                    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
                                    xmlns:mox="http://www.xml-project.com/morganaxproc"
                                    xmlns:lap="https://www.mzk.cz/ns/libri-augmentati/processing/1.0"
                                    xmlns:lar="https://www.mzk.cz/ns/libri-augmentati/report/1.0"
                                    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
                                    xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <call step="p:identity">
                     <port name="source"/>
                  </call>
               </body>
            </step>
         </body>
      </library>
   </analysis>
   <analysis file-name="nametag.xpl"
             path="file:///V:/Projekty/Github/MZK/libri-augmentati/src/xproc/nametag.xpl"
             xmlns="https://www.daliboris.cz/ns/xproc/analysis"
             xmlns:xhtml="http://www.w3.org/1999/xhtml">
      <library>
         <prolog>
            <documentation length="0">
               <section xmlns="http://www.w3.org/1999/xhtml"
                        xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                        xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                        xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
            </documentation>
            <namespaces>
               <namespace prefix=""
                          value="http://www.w3.org/1999/xhtml"/>
               <namespace prefix="lad"
                          value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
               <namespace prefix="lant"
                          value="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"/>
               <namespace prefix="las"
                          value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
               <namespace prefix="p"
                          value="http://www.w3.org/ns/xproc"/>
               <namespace prefix="xs"
                          value="http://www.w3.org/2001/XMLSchema"/>
               <namespace prefix="xml"
                          value="http://www.w3.org/XML/1998/namespace"/>
            </namespaces>
         </prolog>
         <body>
            <documentation length="0">
               <section xmlns="http://www.w3.org/1999/xhtml"
                        xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                        xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                        xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
            </documentation>
            <step type="lant:get-nametag-analysis"
                  name="getting-nametag-analysis">
               <prolog>
                  <documentation length="178">
                     <section xmlns="http://www.w3.org/1999/xhtml"
                              xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <p>Převede vstupní text na dokument ve formátu XML.</p>
                        <p>Zavolá API služby NameTag, předá jí text k rozpoznání a výsledek (dokument JSON) převede pomocí XSLT transformace na validní XML.</p>
                     </section>
                  </documentation>
                  <namespaces>
                     <namespace prefix=""
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lant"
                                value="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <input port="settings"
                            primary="false"/>
                     <input port="report-in"
                            primary="false"/>
                     <output port="result"
                             primary="true"/>
                     <output port="report"
                             pipe="report-in@getting-nametag-analysis"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="178">
                     <section xmlns="http://www.w3.org/1999/xhtml"
                              xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                              xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                              xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">
                        <p>Převede vstupní text na dokument ve formátu XML.</p>
                        <p>Zavolá API služby NameTag, předá jí text k rozpoznání a výsledek (dokument JSON) převede pomocí XSLT transformace na validní XML.</p>
                     </section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:variable"
                        name="service">
                     <parameter name="select"
                                value="//las:service[@code='nametag']"/>
                     <parameter name="pipe"
                                value="settings@getting-nametag-analysis"/>
                  </call>
                  <call step="p:variable"
                        name="service-url">
                     <parameter name="select"
                                value="$service/las:api/@url"/>
                     <parameter name="p:documentation"
                                value="URL RESTové služby."/>
                  </call>
                  <call step="p:variable"
                        name="api-id">
                     <parameter name="select"
                                value="substring-after($service/las:api/@ref, '#')"/>
                     <parameter name="p:documentation"
                                value="Identifikátor RESTové služby."/>
                  </call>
                  <call step="p:variable"
                        name="feature">
                     <parameter name="select"
                                value="//las:api[@xml:id=$api-id]/las:feature[@type='entities'][@method='post']"/>
                     <parameter name="pipe"
                                value="settings@getting-nametag-analysis"/>
                  </call>
                  <call step="p:variable"
                        name="step-url">
                     <parameter name="select"
                                value="concat($service-url, $feature/@url)"/>
                  </call>
                  <call step="p:variable"
                        name="full-text">
                     <parameter name="select"
                                value="."/>
                  </call>
                  <call step="p:http-request">
                     <parameter name="href"
                                value="{$step-url}"/>
                     <parameter name="method"
                                value="'POST'"/>
                     <parameter name="p:documentation"
                                value="&#xA;    &#xA;     Volání API služby NameTag pomocí metodyPOST. Jako vstupní parametr služby se předává prostý text, kódovaný pro URI.&#xA;    &#xA;   "/>
                     <port name="anonymous"/>
                  </call>
                  <call step="p:identity"
                        name="final"/>
               </body>
            </step>
            <step type="lant:convert-nametag-analysis-to-xml">
               <prolog>
                  <namespaces>
                     <namespace prefix=""
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lant"
                                value="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <ports>
                     <input port="source"
                            primary="true"
                            content-types="application/json"/>
                     <output port="result"
                             primary="true"
                             content-types="application/xml"/>
                  </ports>
               </prolog>
               <body>
                  <call step="p:variable"
                        name="model">
                     <parameter name="select"
                                value="normalize-space(?model)"/>
                  </call>
                  <call step="p:cast-content-type">
                     <parameter name="content-type"
                                value="application/xml"/>
                     <port name="source">
                        <parameter name="select"
                                   value="?result"/>
                     </port>
                  </call>
                  <call step="p:xslt">
                     <parameter name="version"
                                value="3.0"/>
                     <port name="stylesheet"/>
                  </call>
                  <call step="p:cast-content-type">
                     <parameter name="content-type"
                                value="application/xml"/>
                  </call>
                  <call step="p:choose"
                        length="1"/>
               </body>
            </step>
            <step type="lant:get-nametag-analyses"
                  name="getting-nametag-analyses">
               <prolog>
                  <documentation length="172">
                     <a href="https://ufal.mff.cuni.cz/nametag/2"
                        alt="NameTag"
                        xmlns="http://www.w3.org/1999/xhtml"
                        xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                        xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                        xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">NameTag</a>
                  </documentation>
                  <namespaces>
                     <namespace prefix=""
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="lad"
                                value="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"/>
                     <namespace prefix="lant"
                                value="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"/>
                     <namespace prefix="las"
                                value="https://www.mzk.cz/ns/libri-augmentati/settings/1.0"/>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                     <option name="output-directory"
                             required="true"
                             as="xs:string"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <input port="settings"
                            primary="false"/>
                     <input port="report-in"
                            primary="false"/>
                     <output port="result"
                             primary="true"
                             pipe="@final-report"/>
                     <output port="report"
                             pipe="result@final-report"/>
                     <output port="data"
                             sequence="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="172">
                     <a href="https://ufal.mff.cuni.cz/nametag/2"
                        alt="NameTag"
                        xmlns="http://www.w3.org/1999/xhtml"
                        xmlns:lant="https://www.mzk.cz/ns/libri-augmentati/nametag/1.0"
                        xmlns:lad="https://www.mzk.cz/ns/libri-augmentati/documents/1.0"
                        xmlns:las="https://www.mzk.cz/ns/libri-augmentati/settings/1.0">NameTag</a>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:variable"
                        name="main-directory-path">
                     <parameter name="select"
                                value="//lant:request/@main-directory-path"/>
                  </call>
                  <call step="p:variable"
                        name="result-directory-path">
                     <parameter name="select"
                                value="concat($output-directory, '/nametag')"/>
                     <parameter name="p:documentation"
                                value="Složka, do níž se uloží stažené dokumenty. Cesta ke složce může být absolutní i relativní."/>
                  </call>
                  <call step="p:variable"
                        name="result-directory-uri">
                     <parameter name="select"
                                value="resolve-uri($result-directory-path, $base-uri)"/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:store"
                                value="&#xA;    &#xA;   "/>
                  </call>
                  <call step="p:variable"
                        name="input">
                     <parameter name="select"
                                value="//lad:page"/>
                     <parameter name="pipe"
                                value="source@getting-nametag-analyses"/>
                  </call>
                  <call step="p:variable"
                        name="root">
                     <parameter name="select"
                                value="/*"/>
                     <parameter name="pipe"
                                value="source@getting-nametag-analyses"/>
                  </call>
                  <call step="p:for-each">
                     <port name="anonymous">
                        <parameter name="select"
                                   value="//lad:pages/lad:page"/>
                     </port>
                  </call>
                  <call step="p:identity"
                        name="data">
                     <port name="source">
                        <parameter name="pipe"
                                   value="data@loop"/>
                     </port>
                  </call>
                  <call step="p:wrap-sequence">
                     <parameter name="wrapper"
                                value="lant:step"/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="result@loop"/>
                     </port>
                     <parameter name="p:documentation"
                                value="Zabalení sekvence elementů &lt;lant:item&lt; do nadřazeného elementu."/>
                  </call>
                  <call step="p:set-attributes">
                     <parameter name="match"
                                value="/*"/>
                     <parameter name="attributes"
                                value="map{    'name' :  'getting-nametag-analyses',     'result-directory-path' : $result-directory-path     }"/>
                  </call>
                  <call step="p:identity"
                        name="metadata"/>
                  <call step="p:insert"
                        name="final-report">
                     <parameter name="match"
                                value="lant:report/lant:result"/>
                     <parameter name="position"
                                value="last-child"/>
                     <parameter name="p:documentation"
                                value="Doplnění zprávy o zpracovaných prvcích."/>
                     <port name="source">
                        <parameter name="pipe"
                                   value="source@getting-nametag-analyses"/>
                     </port>
                     <port name="insertion">
                        <parameter name="pipe"
                                   value="@metadata"/>
                     </port>
                  </call>
               </body>
            </step>
         </body>
      </library>
   </analysis>
   <analysis file-name="tei.xpl"
             path="file:///V:/Projekty/Github/MZK/libri-augmentati/src/xproc/tei.xpl"
             xmlns="https://www.daliboris.cz/ns/xproc/analysis"
             xmlns:xhtml="http://www.w3.org/1999/xhtml">
      <library>
         <prolog>
            <documentation length="0">
               <xhtml:section xmlns:xf="https://www.example.com/ns/xproc/function">
                  <xhtml:h1/>
                  <xhtml:p/>
               </xhtml:section>
            </documentation>
            <namespaces>
               <namespace prefix="p"
                          value="http://www.w3.org/ns/xproc"/>
               <namespace prefix="xf"
                          value="https://www.example.com/ns/xproc/function"/>
               <namespace prefix="xhtml"
                          value="http://www.w3.org/1999/xhtml"/>
               <namespace prefix="xs"
                          value="http://www.w3.org/2001/XMLSchema"/>
               <namespace prefix="xml"
                          value="http://www.w3.org/XML/1998/namespace"/>
            </namespaces>
         </prolog>
         <body>
            <documentation length="0">
               <xhtml:section xmlns:xf="https://www.example.com/ns/xproc/function">
                  <xhtml:h1/>
                  <xhtml:p/>
               </xhtml:section>
            </documentation>
            <step type="xf:first-function-tei"
                  name="fist-function">
               <prolog>
                  <documentation length="0">
                     <xhtml:section xmlns:xf="https://www.example.com/ns/xproc/function">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xf"
                                value="https://www.example.com/ns/xproc/function"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="0">
                     <xhtml:section xmlns:xf="https://www.example.com/ns/xproc/function">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:xslt">
                     <port name="stylesheet">
                        <parameter name="href"
                                   value="../Xslt/?.xsl"/>
                     </port>
                     <parameter name="parameters"
                                value="map {'parameter' : 'value' }"/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:store"
                                value=""/>
                  </call>
               </body>
            </step>
         </body>
      </library>
   </analysis>
   <analysis file-name="udpipe.xpl"
             path="file:///V:/Projekty/Github/MZK/libri-augmentati/src/xproc/udpipe.xpl"
             xmlns="https://www.daliboris.cz/ns/xproc/analysis"
             xmlns:xhtml="http://www.w3.org/1999/xhtml">
      <library>
         <prolog>
            <documentation length="0">
               <xhtml:section xmlns:xf="https://www.example.com/ns/xproc/function">
                  <xhtml:h1/>
                  <xhtml:p/>
               </xhtml:section>
            </documentation>
            <namespaces>
               <namespace prefix="p"
                          value="http://www.w3.org/ns/xproc"/>
               <namespace prefix="xf"
                          value="https://www.example.com/ns/xproc/function"/>
               <namespace prefix="xhtml"
                          value="http://www.w3.org/1999/xhtml"/>
               <namespace prefix="xs"
                          value="http://www.w3.org/2001/XMLSchema"/>
               <namespace prefix="xml"
                          value="http://www.w3.org/XML/1998/namespace"/>
            </namespaces>
         </prolog>
         <body>
            <documentation length="0">
               <xhtml:section xmlns:xf="https://www.example.com/ns/xproc/function">
                  <xhtml:h1/>
                  <xhtml:p/>
               </xhtml:section>
            </documentation>
            <step type="xf:first-function-udpipe"
                  name="fist-function">
               <prolog>
                  <documentation length="0">
                     <xhtml:section xmlns:xf="https://www.example.com/ns/xproc/function">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <namespaces>
                     <namespace prefix="p"
                                value="http://www.w3.org/ns/xproc"/>
                     <namespace prefix="xf"
                                value="https://www.example.com/ns/xproc/function"/>
                     <namespace prefix="xhtml"
                                value="http://www.w3.org/1999/xhtml"/>
                     <namespace prefix="xs"
                                value="http://www.w3.org/2001/XMLSchema"/>
                     <namespace prefix="xml"
                                value="http://www.w3.org/XML/1998/namespace"/>
                  </namespaces>
                  <options>
                     <option name="debug-path"
                             select="()"
                             as="xs:string?"/>
                     <option name="base-uri"
                             as="xs:anyURI"
                             select="static-base-uri()"/>
                  </options>
                  <ports>
                     <input port="source"
                            primary="true"/>
                     <output port="result"
                             primary="true"/>
                  </ports>
               </prolog>
               <body>
                  <documentation length="0">
                     <xhtml:section xmlns:xf="https://www.example.com/ns/xproc/function">
                        <xhtml:h2/>
                        <xhtml:p/>
                     </xhtml:section>
                  </documentation>
                  <call step="p:variable"
                        name="debug">
                     <parameter name="select"
                                value="$debug-path || '' ne ''"/>
                  </call>
                  <call step="p:variable"
                        name="debug-path-uri">
                     <parameter name="select"
                                value="resolve-uri($debug-path, $base-uri)"/>
                  </call>
                  <call step="p:xslt">
                     <port name="stylesheet">
                        <parameter name="href"
                                   value="../Xslt/?.xsl"/>
                     </port>
                     <parameter name="parameters"
                                value="map {'parameter' : 'value' }"/>
                  </call>
                  <call step="p:if">
                     <parameter name="test"
                                value="$debug"/>
                     <parameter name="p:store"
                                value=""/>
                  </call>
               </body>
            </step>
         </body>
      </library>
   </analysis>
</xpan:report>